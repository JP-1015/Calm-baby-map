<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calm Baby Helper — Interactive</title>
<link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#0b0c10">
<link rel="icon" sizes="192x192" href="./icons/icon-192.png">
<link rel="icon" sizes="512x512" href="./icons/icon-512.png">
<link rel="apple-touch-icon" href="./icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Calm Baby">
<meta name="format-detection" content="telephone=no">
<style>
  :root{ --bg:#0b0c10; --card:#111217; --text:#e8ecf1; --muted:#a9b3c1;
         --accent:#7ee081; --accent-2:#8ec5ff; --danger:#ff8e8e;
         --shadow:0 10px 30px rgba(0,0,0,.35); --radius:16px; }
  [data-theme="light"]{ --bg:#f6f7fb; --card:#ffffff; --text:#111217; --muted:#4b5565;
                        --accent:#1ea672; --accent-2:#1f6fff; --danger:#ce2b2b; --shadow:0 10px 30px rgba(0,0,0,.08); }
  html,body{height:100%}
  body{margin:0;font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  .app{ max-width: 780px; margin:0 auto; padding: clamp(16px, 3vw, 28px); }
  header{ display:flex; align-items:center; gap:12px; justify-content: space-between; margin-bottom: 12px; }
  .brand{ display:flex; gap:12px; align-items:center; }
  .logo{ width:40px; height:40px; border-radius:12px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: var(--shadow); }
  h1{ font-size: clamp(20px, 4vw, 26px); margin:0; letter-spacing: .2px; }
  .card{ background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); padding: clamp(16px, 3vw, 22px); }
  .muted{ color: var(--muted); font-size: 0.95rem; }
  .controls{ display:flex; gap:10px; flex-wrap: wrap; align-items:center; }
  .btn{ appearance:none; border:none; cursor:pointer; background: #1a1d25; color: #e8ecf1; padding: 12px 14px; border-radius: 12px; font-weight: 600; transition: transform .06s ease, background .2s; touch-action: manipulation; }
  .btn:hover{ transform: translateY(-1px); }
  .btn:active{ transform: translateY(0); }
  .btn.primary{ background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#0b0c10; }
  .btn.ghost{ background: transparent; border:1px solid rgba(255,255,255,.12); color:var(--text) }
  .btn.small{ padding:8px 10px; border-radius:10px; font-weight:700; }
  .stack{ display:flex; flex-direction:column; gap: 14px; }
  .question{ font-size: clamp(18px, 3.5vw, 22px); line-height:1.3; margin: 4px 0 2px; }
  .answers{ display:grid; gap:10px; grid-template-columns: 1fr; margin-top: 8px;}
  @media (min-width:560px){ .answers{ grid-template-columns: 1fr 1fr; } }
  .chip{ background:#161922; border:1px solid rgba(255,255,255,.12); padding:12px 12px; border-radius:12px; cursor:pointer; text-align:left; display:flex; gap:10px; align-items:flex-start; }
  .chip:hover{ background:#1d2230 }
  .chip strong{ display:block }
  .hint{ color:var(--muted); font-size:.9rem }
  .breadcrumb{ display:flex; flex-wrap:wrap; gap:8px; margin: 10px 0 6px; }
  .crumb{ background: rgba(255,255,255,.07); padding:6px 10px; border-radius:999px; font-size:.85rem; }
  .footer-actions{ display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; margin-top: 10px; }
  .note{ background: rgba(126,224,129,.12); border:1px solid rgba(126,224,129,.3); color: var(--text); padding:10px 12px; border-radius: 10px; font-size:.95rem; }
  .section-title{ font-weight:800; margin:6px 0 2px; font-size: 1rem; letter-spacing:.2px; }
  .recommendations{ background:#0f1420; border:1px solid rgba(255,255,255,.12); padding:12px; border-radius:12px; display:none; }
  [data-theme="light"] .recommendations{ background:#f5f8ff; }
  .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: rgba(255,255,255,.1); border-radius:6px; padding:2px 6px }
  .pill{ background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#0b0c10; border-radius:999px; display:inline-block; padding: 6px 10px; font-weight:800; font-size:.85rem; }
  .topbar{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin: 12px 0 16px; }
  .toggle{ display:flex; gap:8px; align-items:center; background: rgba(255,255,255,.08); padding:6px; border-radius:999px; }
  .toggle button{ border:none; background:transparent; color:var(--text); padding:6px 10px; border-radius:999px; cursor:pointer; }
  .toggle button[aria-pressed="true"]{ background:var(--card); box-shadow: var(--shadow); }
  .tip{ font-size:.9rem; color:var(--muted); }
</style>
</head>
<body data-theme="dark">
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Calm Baby Helper</h1>
          <div class="muted">Interactive decision guide for tricky moments</div>
        </div>
      </div>
      <div class="controls">
        <div class="toggle" role="group" aria-label="Theme toggle">
          <button id="darkBtn" aria-pressed="true" title="Fridge mode (dark)">Dark</button>
          <button id="lightBtn" aria-pressed="false" title="Light mode">Light</button>
        </div>
      </div>
    </header>

    <div class="card stack" role="region" aria-label="Decision assistant">
      <div class="topbar">
        <div class="pill" id="scenarioTag">Pick a scenario</div>
        <div class="controls">
          <button class="btn small ghost" id="resumeBtn" title="Resume last session">Resume</button>
          <button class="btn small ghost" id="restartBtn" title="Restart">Restart</button>
        </div>
      </div>

      <div class="breadcrumb" id="breadcrumb" aria-live="polite"></div>
      <div id="screen"></div>

      <div class="recommendations" id="recs" aria-live="polite">
        <div class="section-title">Your next steps</div>
        <div id="recsList"></div>
        <div class="tip" style="margin-top:8px">Tip: you can screenshot this or share the link to your partner. Progress is saved on this device.</div>
      </div>

      <div class="footer-actions">
        <div class="controls">
          <button class="btn small" id="backBtn" aria-label="Go back"><span aria-hidden="true">←</span> Back</button>
          <button class="btn small primary" id="nextBtn" aria-label="Next step">Next <span aria-hidden="true">→</span></button>
        </div>
        <div class="controls">
          <button class="btn small ghost" id="exportBtn" title="Copy summary">Copy Summary</button>
        </div>
      </div>
    </div>

    <p class="tip" style="margin-top:12px">
      Works offline after first open. Add to Home Screen to use it like an app. Not medical advice.
    </p>
  </div>

<script>
// Register service worker for offline
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js');
  });
}

// ---- Decision Trees (v3) ----
const TREE = {
  id: "root",
  type: "start",
  title: "Choose a scenario",
  options: [
    { id: "bf", label: "Breastfeeding: latch/full feeds", hint: "Won’t latch, shallow latch, sleepy at breast" },
    { id: "cry", label: "Crying + pushing away", hint: "Overstimulated, overtired, discomfort" },
    { id: "cluster", label: "Cluster feeding (evening)", hint: "Multiple consecutive hours, 5pm–midnight" }
  ]
};

const NODES = {
  "bf:start": { id:"bf:start", type:"question", prompt:"What’s happening right now?", answers:[
    { label:"Baby won’t latch", next:"bf:wontLatch" },
    { label:"Latch hurts / shallow", next:"bf:shallow" },
    { label:"Baby too sleepy at breast", next:"bf:sleepy" },
    { label:"Feeding but not getting full", next:"bf:notFull" }
  ]},
  "bf:wontLatch": { id:"bf:wontLatch", type:"action", title:"Try in order:", steps:[
    "Skin-to-skin in dim light 2–3 min.",
    "Laid-back position; nose-to-nipple; wait for wide mouth.",
    "Soften if firm (hand-express 1–2 min / reverse pressure softening).",
    "Tease a drop of milk on lip; bring baby on chin-first.",
    "Offer 1–5 mL expressed milk, then reattempt latch."
  ], next:"bf:wontLatchCheck" },
  "bf:wontLatchCheck": { id:"bf:wontLatchCheck", type:"question", prompt:"Did baby latch and start swallowing?", answers:[
    { label:"Yes", next:"bf:activeFeed" },
    { label:"Not yet", next:"bf:protectSupply" }
  ]},
  "bf:protectSupply": { id:"bf:protectSupply", type:"action", title:"Protect milk supply this feed", steps:[
    "Pump 10–15 min (both sides).",
    "Feed expressed milk (paced bottle/cup/syringe).",
    "Try latching next feed; repeat."
  ], next:"bf:end" },
  "bf:activeFeed": { id:"bf:activeFeed", type:"action", title:"Keep milk flowing", steps:[
    "Watch suck–swallow rhythm.",
    "Use breast compressions when sucking slows.",
    "Burp and switch sides; return to first side if still full."
  ], next:"bf:end" },
  "bf:shallow": { id:"bf:shallow", type:"action", title:"Deepen the latch", steps:[
    "Nose-to-nipple; wait for wide mouth; chin-first.",
    "Try football or side-lying for a better angle.",
    "If pain >30 sec, break seal and relatch."
  ], next:"bf:end" },
  "bf:sleepy": { id:"bf:sleepy", type:"action", title:"Wake and engage", steps:[
    "Skin-to-skin; undress to diaper.",
    "Rub feet/back, quick diaper change.",
    "Breast compressions to keep swallowing."
  ], next:"bf:end" },
  "bf:notFull": { id:"bf:notFull", type:"action", title:"Boost transfer", steps:[
    "Start on fuller side; compressions.",
    "Switch when swallowing slows; burp in between.",
    "Warm compress/massage or brief hand-express to trigger let-down."
  ], next:"bf:end" },
  "bf:end": { id:"bf:end", type:"end", title:"Breastfeeding tips saved", summary:true },

  "cry:start": { id:"cry:start", type:"question", prompt:"Pick what fits best right now", answers:[
    { label:"Loud cry + pushing away", next:"cry:overstim" },
    { label:"Fussy during/after feed", next:"cry:feeding" },
    { label:"Seems overtired", next:"cry:overtired" }
  ]},
  "cry:overstim": { id:"cry:overstim", type:"action", title:"Reset stimulation", steps:[
    "Dim lights, lower noise; move to calm room.",
    "Hold upright facing away; steady sway.",
    "Once calmer, try usual soothe (rock, hum, pacifier)."
  ], next:"cry:end" },
  "cry:feeding": { id:"cry:feeding", type:"question", prompt:"Is this during or right after feeding?", answers:[
    { label:"During", next:"cry:duringFeed" },
    { label:"After", next:"cry:afterFeed" }
  ]},
  "cry:duringFeed": { id:"cry:duringFeed", type:"action", title:"Adjust the feed", steps:[
    "Pause to burp; keep baby more upright.",
    "Bottle: adjust nipple flow (slower/faster per cues).",
    "Breast: laid-back or side-lying; relatch if shallow."
  ], next:"cry:end" },
  "cry:afterFeed": { id:"cry:afterFeed", type:"action", title:"Post-feed soothe", steps:[
    "Hold upright 10–20 min.",
    "Try colic hold (tummy over forearm).",
    "Avoid active play right away; check diaper/gas."
  ], next:"cry:end" },
  "cry:overtired": { id:"cry:overtired", type:"action", title:"Settle for sleep", steps:[
    "Swaddle if under ~8 weeks and not rolling.",
    "Dark room + steady white noise.",
    "Slow, small rocking/bouncing; pacifier if they like it."
  ], next:"cry:end" },
  "cry:end": { id:"cry:end", type:"end", title:"Soothing steps saved", summary:true },

  "cluster:start": { id:"cluster:start", type:"question", prompt:"How does this evening look?", answers:[
    { label:"Multiple consecutive hours (3–6h)", next:"cluster:prolonged" },
    { label:"Frequent but baby calm between", next:"cluster:calmBetween" },
    { label:"Frequent and crying between", next:"cluster:cryBetween" },
    { label:"It’s past midnight now", next:"cluster:lateNight" }
  ]},
  "cluster:prolonged": { id:"cluster:prolonged", type:"action", title:"Set up for the long haul (2–3h blocks repeated)", steps:[
    "Pick an evening 'nest': same chair, dim lamp, water/snacks in reach.",
    "Feed on demand with intent: offer both sides each cycle, use compressions.",
    "Between feeds: burp, brief change, 10–20 min contact hold or low-stim walk.",
    "Rotate holds to protect your body (cross-cradle → football → side-lying)."
  ], next:"cluster:prolongedBranch" },
  "cluster:prolongedBranch": { id:"cluster:prolongedBranch", type:"question", prompt:"Between these frequent feeds, baby is…", answers:[
    { label:"Mostly calm/content", next:"cluster:contentPlan" },
    { label:"Fussy/crying", next:"cluster:fussyPlan" },
    { label:"Drowsy but waking after short naps", next:"cluster:napRescue" }
  ]},
  "cluster:contentPlan": { id:"cluster:contentPlan", type:"action", title:"Content between feeds — keep it sustainable", steps:[
    "Pace yourself: brief stretch/water every 30–45 min.",
    "Hand-over-hand support or side-lying to rest shoulders.",
    "If nipples sore: use expressed-milk 'drizzle' to help latch; consider hydrogel pads between sessions."
  ], next:"cluster:topUpQ" },
  "cluster:fussyPlan": { id:"cluster:fussyPlan", type:"action", title:"Fussy between feeds — reduce overload", steps:[
    "Lower stimulation: darker room, fewer voices, steady white noise.",
    "Burp more than usual; try colic hold and tummy-down over forearm.",
    "Swaddle reset (if under ~8 weeks and not rolling); then re-offer."
  ], next:"cluster:topUpQ" },
  "cluster:napRescue": { id:"cluster:napRescue", type:"action", title:"Bridge naps between feeds", steps:[
    "Aim for 10–20 min 'micro-naps' on you or in carrier to avoid overtired spiral.",
    "At the first stir, gentle jiggle/shush to extend a few minutes.",
    "Keep wake windows short this late; prioritize calming over play."
  ], next:"cluster:topUpQ" },
  "cluster:topUpQ": { id:"cluster:topUpQ", type:"question", prompt:"Still very upset / repeatedly unlatching after several cycles?", answers:[
    { label:"Yes, consider small expressed-milk top-up", next:"cluster:topUp" },
    { label:"No, continue feeding rhythm", next:"cluster:survival" }
  ]},
  "cluster:topUp": { id:"cluster:topUp", type:"action", title:"Top-up without derailing breastfeeding", steps:[
    "Offer 10–20 mL expressed milk via paced bottle or syringe/cup.",
    "Use paced technique: horizontal bottle, pauses every 5–10 sucks, swap sides halfway.",
    "Pump 10–15 min once tonight to signal demand if you routinely top-up."
  ], next:"cluster:survival" },
  "cluster:survival": { id:"cluster:survival", type:"action", title:"Parent survival checklist", steps:[
    "Hydrate + snack each hour; set timer if needed.",
    "Alternate sides/holds to protect wrists/neck; use pillows.",
    "Plan one micro-break: bathroom/shower reset while partner holds baby in dim room.",
    "Line up your 'wind-down' cue when things ease (white noise + lights low)."
  ], next:"cluster:redFlagsQ" },
  "cluster:lateNight": { id:"cluster:lateNight", type:"action", title:"When cluster rolls past midnight", steps:[
    "Switch to 'night mode': very dim light, minimal talking/eye contact.",
    "Choose: contact sleep on you for a first longer stretch OR a bassinet attempt with a warm-up (warm sheet briefly, then remove, lay down feet-first).",
    "Protect one longer stretch: after a solid feed/burp, keep upright 15–20 min, then try to settle without full wake."
  ], next:"cluster:redFlagsQ" },
  "cluster:redFlagsQ": { id:"cluster:redFlagsQ", type:"question", prompt:"Any red flags? (fever ≥38°C/100.4°F under 3 months, fewer than 3–4 wets after day 4, green/bilious vomit, blood in stool, breathing trouble, inconsolable >2h)", answers:[
    { label:"Yes", next:"cluster:redFlags" },
    { label:"No", next:"cluster:end" }
  ]},
  "cluster:redFlags": { id:"cluster:redFlags", type:"action", title:"Call your provider now", steps:[
    "These signs need medical input.",
    "Keep baby upright and hydrated; note feeding patterns and diapers.",
    "Seek care today."
  ], next:"cluster:end" },
  "cluster:end": { id:"cluster:end", type:"end", title:"Cluster plan saved", summary:true }
};

// ---- App shell ----
const screen = document.getElementById('screen');
const breadcrumb = document.getElementById('breadcrumb');
const nextBtn = document.getElementById('nextBtn');
const backBtn = document.getElementById('backBtn');
const restartBtn = document.getElementById('restartBtn');
const resumeBtn = document.getElementById('resumeBtn');
const exportBtn = document.getElementById('exportBtn');
const recs = document.getElementById('recs');
const recsList = document.getElementById('recsList');
const scenarioTag = document.getElementById('scenarioTag');

const THEME = {
  set(mode){ document.body.setAttribute('data-theme', mode); localStorage.setItem('cbh_theme', mode); },
  init(){ const saved = localStorage.getItem('cbh_theme', 'dark') || 'dark'; this.set(saved); document.getElementById(saved==='dark'?'darkBtn':'lightBtn').setAttribute('aria-pressed','true'); }
};
document.getElementById('darkBtn').addEventListener('click',()=>{ THEME.set('dark'); document.getElementById('darkBtn').setAttribute('aria-pressed','true'); document.getElementById('lightBtn').setAttribute('aria-pressed','false'); });
document.getElementById('lightBtn').addEventListener('click',()=>{ THEME.set('light'); document.getElementById('darkBtn').setAttribute('aria-pressed','false'); document.getElementById('lightBtn').setAttribute('aria-pressed','true'); });
THEME.init();

let state = { path: [], node: TREE, answers: [], recs: [] };

function saveState(){
  localStorage.setItem('cbh_state_pages_js', JSON.stringify({
    path: state.path, nodeId: state.node.id || state.node.type, answers: state.answers, recs: state.recs
  }));
}
function loadState(){
  const raw = localStorage.getItem('cbh_state_pages_js');
  if(!raw) return false;
  try{
    const d = JSON.parse(raw);
    state.path = d.path || []; state.answers = d.answers || []; state.recs = d.recs || [];
    if(d.nodeId === 'root'){ state.node = TREE; }
    else { state.node = NODES[d.nodeId] || TREE; }
    render();
    return true;
  }catch(e){ return false; }
}

function pushCrumb(text){ state.path.push({ text }); }
function popCrumb(){ state.path.pop(); }
function setScenarioTag(){ const first = state.path[0]?.text || 'Pick a scenario'; scenarioTag.textContent = first; }
function renderBreadcrumb(){ breadcrumb.innerHTML = ''; state.path.forEach(c=>{ const s=document.createElement('span'); s.className='crumb'; s.textContent=c.text; breadcrumb.appendChild(s); }); }
function listSteps(list){ return '<ul>' + list.map(s=>`<li>${s}</li>`).join('') + '</ul>'; }

function renderStart(){
  screen.innerHTML = `
    <div>
      <div class="question">What do you want help with?</div>
      <div class="answers" role="list">
        ${TREE.options.map(opt => `
          <button class="chip" role="listitem" data-sel="${opt.id}">
            <div>
              <strong>${opt.label}</strong>
              <div class="hint">${opt.hint||''}</div>
            </div>
          </button>
        `).join('')}
      </div>
    </div>`;
  document.querySelectorAll('[data-sel]').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-sel');
      const map = { bf:'Breastfeeding', cry:'Crying + pushing', cluster:'Cluster feeding' };
      if(id==='bf') state.node = NODES['bf:start'];
      else if(id==='cry') state.node = NODES['cry:start'];
      else if(id==='cluster') state.node = NODES['cluster:start'];
      state.path = [{ text: map[id]||'Scenario' }];
      state.answers = []; state.recs = [];
      saveState(); render();
    });
  });
  backBtn.disabled = true; nextBtn.disabled = true; recs.style.display = 'none'; setScenarioTag(); renderBreadcrumb();
}

function renderQuestion(node){
  screen.innerHTML = `
    <div>
      <div class="question">${node.prompt}</div>
      <div class="answers" role="list">
        ${node.answers.map((a,i)=>`
          <button class="chip" role="listitem" data-answer="${i}">
            <div><strong>${a.label}</strong></div>
          </button>
        `).join('')}
      </div>
    </div>`;
  document.querySelectorAll('[data-answer]').forEach(btn => {
    btn.addEventListener('click', ()=>{
      const idx = +btn.getAttribute('data-answer');
      const ans = node.answers[idx];
      state.answers.push(ans.label); pushCrumb(ans.label);
      state.node = NODES[ans.next]; saveState(); render();
    });
  });
  backBtn.disabled = state.path.length===1; nextBtn.disabled = true; recs.style.display = 'none'; setScenarioTag(); renderBreadcrumb();
}

function renderAction(node){
  screen.innerHTML = `
    <div>
      <div class="section-title">${node.title||'Try this:'}</div>
      ${listSteps(node.steps)}
      <div class="note">Work through these steps. When you’re ready, tap <span class="kbd">Next →</span>.</div>
    </div>`;
  state.recs.push({ title: node.title, steps: node.steps });
  backBtn.disabled = state.path.length===1; nextBtn.disabled = !node.next; recs.style.display = 'block'; updateRecs(); setScenarioTag(); renderBreadcrumb();
}

function renderEnd(node){
  screen.innerHTML = `
    <div>
      <div class="section-title">You’re set</div>
      <p class="muted">You can restart or adjust answers. If the situation changes, pick a different branch.</p>
    </div>`;
  backBtn.disabled = state.path.length===1; nextBtn.disabled = true; recs.style.display = 'block'; updateRecs(); setScenarioTag(); renderBreadcrumb();
}

function render(){
  if(state.node.type === 'start'){ renderStart(); return; }
  if(state.node.type === 'question'){ renderQuestion(state.node); return; }
  if(state.node.type === 'action'){ renderAction(state.node); return; }
  if(state.node.type === 'end'){ renderEnd(state.node); return; }
}

function updateRecs(){
  const parts = state.recs.map(r=>`<div style="margin:6px 0 10px"><div class="section-title">${r.title||'Steps'}</div>${listSteps(r.steps)}</div>`);
  recsList.innerHTML = parts.join('');
}

document.getElementById('backBtn').addEventListener('click', ()=>{
  if(state.path.length<=1){ state = { path: [], node: TREE, answers: [], recs: [] }; saveState(); render(); return; }
  popCrumb(); state.answers.pop();
  const firstLabel = state.path[0]?.text;
  const firstId = firstLabel==='Breastfeeding'?'bf:start': firstLabel==='Crying + pushing'?'cry:start': 'cluster:start';
  state.node = NODES[firstId]; state.recs = [];
  for(let i=1;i<state.path.length;i++){
    const label = state.path[i].text;
    const ans = state.node.answers?.find(a=>a.label===label);
    if(!ans) break;
    state.node = NODES[ans.next];
    if(state.node.type==='action'){ state.recs.push({ title: state.node.title, steps: state.node.steps }); }
  }
  saveState(); render();
});
document.getElementById('nextBtn').addEventListener('click', ()=>{
  if(state.node.next){ pushCrumb('Next'); state.node = NODES[state.node.next]; saveState(); render(); }
});
document.getElementById('restartBtn').addEventListener('click', ()=>{ state = { path: [], node: TREE, answers: [], recs: [] }; saveState(); render(); });
document.getElementById('resumeBtn').addEventListener('click', ()=>{ const ok = loadState(); if(!ok){ alert('No previous session found.'); render(); } });
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const lines = []; lines.push(`Calm Baby Helper — Summary`);
  if(state.path[0]) lines.push(`Scenario: ${state.path[0].text}`);
  state.recs.forEach((r,i)=>{ lines.push(`\nStep block ${i+1}: ${r.title}`); r.steps.forEach(s=>lines.push(`• ${s}`)); });
  const text = lines.join('\n');
  navigator.clipboard.writeText(text).then(()=>{ exportBtn.textContent = 'Copied!'; setTimeout(()=>exportBtn.textContent='Copy Summary', 1200); }).catch(()=>{ alert(text); });
});

// Initial render
render();
</script>
</body>
</html>