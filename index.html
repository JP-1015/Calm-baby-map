
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Calm Baby Map</title>
<link rel="icon" href="./favicon.ico">
<link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
<link rel="apple-touch-icon" href="./icons/icon-192.png">
<link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#4b0082">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#ffffff;color:#4b0082}
  .app{max-width:860px;margin:0 auto;padding:20px}
  .card{background:#f8f0ff;border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(75,0,130,.25)}
  h1{margin:.2rem 0 0.4rem;color:#4b0082}
  h2{color:#6a0dad;margin:.2rem 0 1rem}
  .grid{display:grid;gap:10px}
  button{padding:12px;background:#ffffff;border:2px solid #a64ca6;border-radius:12px;color:#4b0082;font-weight:600;cursor:pointer;text-align:left}
  button:hover{background:#e6ccff}
  .note{background:#f0e6ff;border:1px solid #c299ff;padding:8px 10px;border-radius:10px;color:#4b0082;margin-top:10px}
  .back{margin-top:10px;display:inline-block;color:#6a0dad;font-weight:600;cursor:pointer}
  .subtitle{font-size:1rem;font-weight:700;color:#6a0dad;margin-bottom:1rem}
  .footer{margin-top:12px;color:#6a0dad;font-size:.9rem}
  .home-btn{position:fixed;left:16px;bottom:16px;background:#a64ca6;color:#fff;border:none;padding:12px 14px;border-radius:999px;
            font-weight:800;box-shadow:0 6px 20px rgba(75,0,130,.25);cursor:pointer}
  .home-btn:hover{opacity:.95}
  .section-label{font-size:.95rem;color:#6a0dad;margin:6px 0 2px}
  .new-badge{background:#a64ca6;color:#fff;border-radius:999px;padding:2px 8px;font-size:.75rem;margin-left:8px}
  .tool-card{background:#fff;border:2px solid #a64ca6;border-radius:12px;padding:12px;margin:8px 0;color:#4b0082}
  .tool-title{font-weight:800;margin-bottom:6px}
  .tool-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .tool-btn{padding:8px 12px;border:2px solid #a64ca6;background:#f8f0ff;border-radius:10px;color:#4b0082;font-weight:700;cursor:pointer}
  .tool-btn:hover{background:#e6ccff}
  .timer{font-weight:800;min-width:84px;display:inline-block}
  .muted{color:#6a0dad}
  .svg-wrap{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0}
  .svg-box{background:#fff;border:2px solid #a64ca6;border-radius:12px;padding:10px}
  hr.purple{border:none;border-top:2px solid #d1b3ff;margin:12px 0}
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <h1>The Calm Baby Map</h1>
    <div class="subtitle">for my baby Lydia</div>
    <div id="content" role="main" aria-live="polite"></div>
    <div class="footer">Tip: add this page to your home screen to use it like an app. Works offline after first load.</div>
  </div>
</div>
<button class="home-btn" aria-label="Go to Home" onclick="goHome()">üè† Home</button>
<script>
if ('serviceWorker' in navigator) { window.addEventListener('load', ()=> navigator.serviceWorker.register('./service-worker.js')); }

const flow = {
  start: { text: "Choose a scenario", render: () => {
    // Custom home layout with two sections and NEW badges
    const care = [
      {label:"Breastfeeding: latch/full feeds", next:"bf_start"},
      {label:"Crying + pushing away", next:"cry_start"},
      {label:"Cluster feeding (evening)", next:"cluster_start"}
    ];
    const extras = [
      {label:"üõ†Ô∏è Tools: Timers & Calming Audio", next:"tools", badge:"NEW"},
      {label:"üçº Burping Positions", next:"burp_positions", badge:"NEW"}
    ];
    let html = '<h2>Choose a scenario</h2>';
    html += '<div class="section-label">Care Scenarios</div><div class="grid">';
    html += care.map(o=>`<button onclick="go('${o.next}')">${o.label}</button>`).join('');
    html += '</div><div class="section-label" style="margin-top:10px">Extras</div><div class="grid">';
    html += extras.map(o=>`<button onclick="go('${o.next}')">${o.label}${o.badge?` <span class='new-badge'>${o.badge}</span>`:''}</button>`).join('');
    html += '</div>';
    return html;
  }},
  /* -------- Breastfeeding -------- */
  bf_start: { text: "What's happening right now?", options: [
    {text: "Baby won‚Äôt latch", next: "bf_wont"},
    {text: "Latch hurts / shallow", next: "bf_shallow"},
    {text: "Baby too sleepy at breast", next: "bf_sleepy"},
    {text: "Feeding but not getting full", next: "bf_notfull"}
  ]},
  bf_wont: { text: "Try in order", list: [
    "Skin-to-skin in dim light for 2‚Äì3 min.",
    "Laid-back position; nose-to-nipple; wait for wide mouth.",
    "Soften a firm breast (hand-express 1‚Äì2 min / gentle pressure).",
    "Tease a drop of milk on lip; bring baby on chin-first.",
    "Offer 1‚Äì5 mL expressed milk, then reattempt latch."
  ], options: [
    {text: "Baby latched ‚Üí keep milk flowing", next: "bf_active"},
    {text: "Still no latch ‚Üí protect supply & feed expressed milk", next: "bf_protect"}
  ], back: "bf_start" },
  bf_active: { text: "Keep milk flowing", list: [
    "Watch suck‚Äìswallow rhythm.",
    "Breast compressions when sucking slows.",
    "Burp and switch sides; return to fuller side if needed."
  ], note: "If most feeds are still tough after 24‚Äì48h, book an IBCLC and check weight/diapers.", back: "bf_start" },
  bf_protect: { text: "Protect milk supply this feed", list: [
    "Pump 10‚Äì15 min (both sides).",
    "Feed expressed milk (paced bottle/cup/syringe).",
    "Try latching next feed; repeat."
  ], options: [{text: "Happening most feeds? ‚Üí Get hands-on help", next: "bf_help"}], back: "bf_start" },
  bf_help: { text: "Get hands-on help", list: [
    "Book an IBCLC; assess latch/transfer/tie.",
    "Check diapers (‚â•6 wets & ‚â•3‚Äì4 yellow stools/day after day 4).",
    "Follow plan while continuing to protect supply."
  ], back: "bf_start" },
  bf_shallow: { text: "Deepen the latch", list: [
    "Nose-to-nipple; wait for wide mouth; chin-first.",
    "Try football or side-lying for a better angle.",
    "If pain >30 sec, break seal and relatch."
  ], back: "bf_start" },
  bf_sleepy: { text: "Wake and engage", list: [
    "Skin-to-skin; undress to diaper.",
    "Rub feet/back, quick diaper change.",
    "Breast compressions to keep swallowing."
  ], back: "bf_start" },
  bf_notfull: { text: "Boost transfer", list: [
    "Start on fuller side; compressions.",
    "Switch when swallowing slows; burp in between.",
    "Warm compress/massage or brief hand-express to trigger let-down."
  ], back: "bf_start" },

  /* -------- Crying + pushing -------- */
  cry_start: { text: "Pick what fits best", options: [
    {text: "Loud cry + pushing away", next: "cry_overstim"},
    {text: "Fussy during/after feed", next: "cry_feed"},
    {text: "Seems overtired", next: "cry_tired"},
    {text: "Possible discomfort", next: "cry_comfort"}
  ]},
  cry_overstim: { text: "Reset stimulation", list: [
    "Dim lights, lower noise; move to a calm room.",
    "Hold upright facing away; steady sway.",
    "Once calmer, try usual soothe (rock, hum, pacifier)."
  ], back: "cry_start" },
  cry_feed: { text: "Is it during or after feeding?", options: [
    {text: "During feed ‚Üí Adjust the feed", next: "cry_during"},
    {text: "After feed ‚Üí Post-feed soothe", next: "cry_after"}
  ], back: "cry_start" },
  cry_during: { text: "Adjust the feed", list: [
    "Pause to burp; keep baby more upright.",
    "Bottle: adjust nipple flow (slower/faster per cues).",
    "Breast: laid-back or side-lying; relatch if shallow."
  ], back: "cry_start" },
  cry_after: { text: "Post-feed soothe", list: [
    "Hold upright 10‚Äì20 min.",
    "Try colic hold (tummy over forearm).",
    "Avoid active play right away; check diaper/gas."
  ], back: "cry_start" },
  cry_tired: { text: "Settle for sleep", list: [
    "Swaddle if under ~8 weeks and not rolling.",
    "Dark room + steady white noise.",
    "Slow, small rocking/bouncing; pacifier if they like it."
  ], back: "cry_start" },
  cry_comfort: { text: "Quick comfort checks", list: [
    "Diaper, temp, clothing tags; check for hair wrapped on finger/toe.",
    "Gas relief: burp, bicycle legs, tummy over forearm.",
    "If persistent or severe, call your provider."
  ], back: "cry_start" },

  /* -------- Cluster feeding (FULL) -------- */
  cluster_start: { text: "How does this evening look?", options: [
    {text: "Multiple consecutive hours (3‚Äì6h)", next: "cluster_prolonged"},
    {text: "Frequent but baby calm between", next: "cluster_calm"},
    {text: "Frequent and crying between", next: "cluster_fussy"},
    {text: "Drowsy + wakes after tiny naps", next: "cluster_nap"},
    {text: "It‚Äôs past midnight now", next: "cluster_latenight"}
  ]},
  cluster_prolonged: { text: "Set up for the long haul (2‚Äì3h blocks repeated)", list: [
    "Pick an evening 'nest': same chair, dim lamp, water/snacks in reach.",
    "Feed on demand with intent: offer both sides each cycle; use compressions.",
    "Between feeds: burp, brief change, 10‚Äì20 min contact hold or low‚Äëstim walk.",
    "Rotate holds to protect your body (cross‚Äëcradle ‚Üí football ‚Üí side‚Äëlying)."
  ], options: [
    {text: "Baby calm between", next: "cluster_calm"},
    {text: "Baby fussy between", next: "cluster_fussy"},
    {text: "Baby drowsy between", next: "cluster_nap"}
  ], back: "cluster_start" },
  cluster_calm: { text: "Content between feeds ‚Äî keep it sustainable", list: [
    "Pace yourself: brief stretch/water every 30‚Äì45 min.",
    "Hand‚Äëover‚Äëhand support or side‚Äëlying to rest shoulders.",
    "If nipples sore: expressed‚Äëmilk drizzle to help latch; hydrogel pads between sessions."
  ], options: [{text: "Still unsettled sometimes? ‚Üí Top‚Äëup decision", next: "cluster_topupq"}], back: "cluster_start" },
  cluster_fussy: { text: "Fussy between feeds ‚Äî reduce overload", list: [
    "Lower stimulation: darker room, fewer voices, steady white noise.",
    "Burp more than usual; try colic hold and tummy‚Äëdown over forearm.",
    "Swaddle reset (if under ~8 weeks and not rolling); then re‚Äëoffer."
  ], options: [{text: "Very upset after several cycles? ‚Üí Top‚Äëup decision", next: "cluster_topupq"}], back: "cluster_start" },
  cluster_nap: { text: "Bridge naps between feeds", list: [
    "Aim for 10‚Äì20 min micro‚Äënaps on you or in carrier to avoid overtired spiral.",
    "At the first stir, gentle jiggle/shush to extend a few minutes.",
    "Keep wake windows short this late; prioritize calming over play."
  ], options: [{text: "Still repeatedly unlatching? ‚Üí Top‚Äëup decision", next: "cluster_topupq"}], back: "cluster_start" },
  cluster_topupq: { text: "Top‚Äëup decision", options: [
    {text: "Yes ‚Äî consider small expressed‚Äëmilk top‚Äëup", next: "cluster_topup"},
    {text: "No ‚Äî keep the rhythm and protect you", next: "cluster_survival"}
  ], back: "cluster_start" },
  cluster_topup: { text: "Top‚Äëup without derailing breastfeeding", list: [
    "Offer 10‚Äì20 mL expressed milk via paced bottle or syringe/cup.",
    "Paced technique: horizontal bottle, pauses every 5‚Äì10 sucks, swap sides halfway.",
    "Pump 10‚Äì15 min once tonight to signal demand if you routinely top‚Äëup."
  ], options: [{text: "Parent survival checklist ‚Üí", next: "cluster_survival"}], back: "cluster_start" },
  cluster_survival: { text: "Parent survival checklist", list: [
    "Hydrate + snack each hour; set a reminder if needed.",
    "Alternate sides/holds; use pillows to protect wrists/neck.",
    "One micro‚Äëbreak: bathroom/shower reset while partner holds baby in dim room.",
    "Line up your ‚Äúwind‚Äëdown‚Äù cue when things ease (white noise + lights low)."
  ], options: [{text: "Safety check ‚Üí Any red flags?", next: "cluster_redflagsq"}], back: "cluster_start" },
  cluster_latenight: { text: "When cluster rolls past midnight", list: [
    "Switch to ‚Äúnight mode‚Äù: very dim light, minimal talking/eye contact.",
    "Contact sleep or bassinet with a brief warm‚Äëup; feet‚Äëfirst down.",
    "Protect one longer stretch: after a solid feed/burp, keep upright 15‚Äì20 min, then try to settle."
  ], options: [{text: "Safety check ‚Üí Any red flags?", next: "cluster_redflagsq"}], back: "cluster_start" },
  cluster_redflagsq: { text: "Any red flags?", list: [
    "Fever ‚â•38¬∞C/100.4¬∞F under 3 months",
    "Fewer than 3‚Äì4 wets after day 4",
    "Green/bilious vomit; blood in stool",
    "Breathing trouble; persistent retractions",
    "Inconsolable >2h"
  ], options: [
    {text: "Yes ‚Äî call your provider now", next: "cluster_redflags"},
    {text: "No ‚Äî you‚Äôre set for tonight", next: "start"}
  ], back: "cluster_start" },
  cluster_redflags: { text: "Call your provider now", list: [
    "These signs need medical input.",
    "Keep baby upright and hydrated; note feeding and diapers.",
    "Seek care today."
  ], back: "start" },

  /* -------- Burping Positions (SVG) -------- */
  burp_positions: { text: "Burping Positions (with visuals)", html: `
    <div class="svg-wrap">
      <div class="svg-box">
        <div class="tool-title">Over-Shoulder</div>
        <svg width="180" height="140" viewBox="0 0 180 140" xmlns="http://www.w3.org/2000/svg" aria-label="Over shoulder burping illustration">
          <rect x="0" y="0" width="180" height="140" rx="12" fill="#f8f0ff" stroke="#a64ca6"/>
          <circle cx="60" cy="70" r="28" fill="#ffe0bd" stroke="#6a0dad"/>
          <rect x="90" y="40" width="18" height="60" rx="8" fill="#a64ca6" opacity="0.3"/>
          <circle cx="120" cy="50" r="18" fill="#ffe0bd" stroke="#6a0dad"/>
          <path d="M70,55 Q80,45 92,50" stroke="#6a0dad" fill="none"/>
          <circle cx="52" cy="65" r="3" fill="#4b0082"/>
          <circle cx="68" cy="65" r="3" fill="#4b0082"/>
          <path d="M52,78 Q60,88 68,78" stroke="#c23" stroke-width="3" fill="none"/>
        </svg>
        <div class="muted">Hold baby high on your shoulder; gentle pats on upper back.</div>
      </div>
      <div class="svg-box">
        <div class="tool-title">Sitting Lap</div>
        <svg width="180" height="140" viewBox="0 0 180 140" xmlns="http://www.w3.org/2000/svg" aria-label="Sitting lap burping illustration">
          <rect x="0" y="0" width="180" height="140" rx="12" fill="#f8f0ff" stroke="#a64ca6"/>
          <rect x="55" y="90" width="70" height="14" rx="7" fill="#a64ca6" opacity="0.3"/>
          <circle cx="90" cy="65" r="18" fill="#ffe0bd" stroke="#6a0dad"/>
          <rect x="78" y="82" width="24" height="10" rx="5" fill="#ffe0bd" stroke="#6a0dad"/>
        </svg>
        <div class="muted">Sit baby upright on your lap; support chin & chest; pat or rub back.</div>
      </div>
      <div class="svg-box">
        <div class="tool-title">Tummy-Down Over Lap</div>
        <svg width="180" height="140" viewBox="0 0 180 140" xmlns="http://www.w3.org/2000/svg" aria-label="Tummy down burping illustration">
          <rect x="0" y="0" width="180" height="140" rx="12" fill="#f8f0ff" stroke="#a64ca6"/>
          <rect x="40" y="85" width="100" height="16" rx="8" fill="#a64ca6" opacity="0.3"/>
          <ellipse cx="100" cy="70" rx="28" ry="16" fill="#ffe0bd" stroke="#6a0dad"/>
          <circle cx="120" cy="63" r="7" fill="#ffe0bd" stroke="#6a0dad"/>
        </svg>
        <div class="muted">Lay baby tummy-down across your lap; support head slightly higher than chest; pat gently.</div>
      </div>
    </div>
    <div class="note">Try each position for ~2‚Äì3 minutes. If no burp, switch positions and continue calmly.</div>
  `, back: "start" },

  /* -------- Tools: Timers & Calming Audio -------- */
  tools: { text: "Tools: Timers & Calming Audio", html: `
    <div class="tool-card">
      <div class="tool-title">Timers</div>
      <div class="tool-row"><span class="timer" id="t_latch">03:00</span>
        <button class="tool-btn" onclick="startTimer('latch',180)">Start 3‚Äëmin Latch</button>
        <button class="tool-btn" onclick="stopTimer('latch')">Stop</button>
        <button class="tool-btn" onclick="resetTimer('latch',180)">Reset</button>
      </div>
      <div class="tool-row"><span class="timer" id="t_pump">15:00</span>
        <button class="tool-btn" onclick="startTimer('pump',900)">Start 15‚Äëmin Pump</button>
        <button class="tool-btn" onclick="stopTimer('pump')">Stop</button>
        <button class="tool-btn" onclick="resetTimer('pump',900)">Reset</button>
      </div>
      <div class="tool-row"><span class="timer" id="t_switch">00:00</span>
        <button class="tool-btn" onclick="startSideSwitch()">Start Side‚ÄëSwitch</button>
        <button class="tool-btn" onclick="stopSideSwitch()">Stop</button>
        <span class="muted">Beeps every 5 min; shows elapsed.</span>
      </div>
    </div>
    <hr class="purple"/>
    <div class="tool-card">
      <div class="tool-title">Calming Audio (loops until you stop)</div>
      <div class="tool-row">
        <button class="tool-btn" onclick="playTrack('lullaby')">Play Lullaby</button>
        <button class="tool-btn" onclick="playTrack('whitenoise')">Play White Noise</button>
        <button class="tool-btn" onclick="playTrack('heartbeat')">Play Heartbeat</button>
        <button class="tool-btn" onclick="stopAudio()">Stop</button>
      </div>
      <div class="muted">Starts only when you tap Play. Audio is generated on‚Äëdevice (no copyrights).</div>
    </div>
  `, back: "start" }
};

let stack = ["start"];

function render(key){
  const node = flow[key];
  let html = '';
  if(node.render){ html = node.render(); }
  else{
    html = `<h2>${node.text}</h2>`;
    if(node.list){ html += '<ul>' + node.list.map(x=>`<li>${x}</li>`).join('') + '</ul>'; }
    if(node.options){ html += '<div class="grid">' + node.options.map(o=>`<button onclick="go('${o.next}')">${o.text}</button>`).join('') + '</div>'; }
    if(node.html){ html += node.html; }
    if(node.note){ html += `<div class="note">${node.note}</div>`; }
  }
  if(node.back){ html += `<div class="back" onclick="back()">‚Üê Back</div>`; }
  document.getElementById('content').innerHTML = html;
}
function go(next){ stack.push(next); render(next); }
function back(){ stack.pop(); render(stack[stack.length-1]); }
function goHome(){ stack = ["start"]; render("start"); }

/* Timers */
const timers = {};
function fmt(s){ const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(Math.floor(s%60)).padStart(2,'0'); return `${m}:${ss}`; }
function tickTimer(key){
  const t = timers[key]; if(!t) return;
  const left = Math.max(0, t.end - Date.now());
  const sec = Math.ceil(left/1000);
  document.getElementById('t_'+key).textContent = fmt(sec);
  if(left <= 0){ stopTimer(key); try{ navigator.vibrate && navigator.vibrate([200,100,200]); }catch(e){} }
  else { t.raf = requestAnimationFrame(()=> tickTimer(key)); }
}
function startTimer(key, seconds){
  stopTimer(key);
  timers[key] = { end: Date.now() + seconds*1000, raf:null, base: seconds };
  tickTimer(key);
}
function stopTimer(key){ const t = timers[key]; if(!t) return; cancelAnimationFrame(t.raf); delete timers[key]; }
function resetTimer(key, seconds){ stopTimer(key); const el = document.getElementById('t_'+key); if(el) el.textContent = fmt(seconds); }

/* Side-switch elapsed + buzz every 5 minutes */
let sideSwitchInterval=null, sideStart=null;
function startSideSwitch(){
  stopSideSwitch();
  sideStart = Date.now();
  document.getElementById('t_switch').textContent = '00:00';
  sideSwitchInterval = setInterval(()=>{
    const elapsed = Math.floor((Date.now()-sideStart)/1000);
    document.getElementById('t_switch').textContent = fmt(elapsed);
    if(elapsed % 300 === 0){ try{ navigator.vibrate && navigator.vibrate([150,80,150]); }catch(e){} }
  }, 1000);
}
function stopSideSwitch(){ if(sideSwitchInterval){ clearInterval(sideSwitchInterval); sideSwitchInterval=null; } }

/* On-device Audio: lullaby, white noise, heartbeat */
let AC = null, current = null, noiseSrc = null, beatInterval = null, lullabyInterval = null, lullabyStep = 0;
function ensureAC(){ if(!AC) AC = new (window.AudioContext || window.webkitAudioContext)(); return AC; }
function stopAudio(){
  if(!AC) return;
  try{ AC.resume && AC.resume(); }catch(e){}
  if(current){ try{ current.stop(0); }catch(e){} current.disconnect(); current=null; }
  if(noiseSrc){ noiseSrc.disconnect(); noiseSrc=null; }
  if(beatInterval){ clearInterval(beatInterval); beatInterval=null; }
  if(lullabyInterval){ clearInterval(lullabyInterval); lullabyInterval=null; }
}
function playTrack(kind){
  stopAudio();
  const ac = ensureAC();
  if(kind==='whitenoise'){
    const bufferSize = 2 * ac.sampleRate;
    const buffer = ac.createBuffer(1, bufferSize, ac.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i=0; i<bufferSize; i++){ data[i] = Math.random()*2-1; }
    const src = ac.createBufferSource(); src.buffer = buffer; src.loop = true;
    const gain = ac.createGain(); gain.gain.value = 0.08;
    src.connect(gain).connect(ac.destination); src.start(0);
    current = src; noiseSrc = src;
  } else if(kind==='heartbeat'){
    const kick = ()=>{
      const o = ac.createOscillator();
      const g = ac.createGain();
      o.type = 'sine'; o.frequency.setValueAtTime(150, ac.currentTime);
      o.frequency.exponentialRampToValueAtTime(50, ac.currentTime+0.1);
      g.gain.setValueAtTime(0.0001, ac.currentTime);
      g.gain.exponentialRampToValueAtTime(0.5, ac.currentTime+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+0.28);
      o.connect(g).connect(ac.destination); o.start(); o.stop(ac.currentTime+0.3);
    };
    beatInterval = setInterval(()=>{ kick(); setTimeout(kick, 200); }, 800);
  } else if(kind==='lullaby'){
    const notes = [261.63, 329.63, 392.00, 440.00, 392.00, 329.63]; // C E G A G E
    lullabyStep = 0;
    lullabyInterval = setInterval(()=>{
      const o = ac.createOscillator();
      const g = ac.createGain();
      o.type = 'sine'; o.frequency.value = notes[lullabyStep % notes.length];
      const t = ac.currentTime;
      g.gain.cancelScheduledValues(t);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(0.18, t+0.03);
      g.gain.exponentialRampToValueAtTime(0.0001, t+0.35);
      o.connect(g).connect(ac.destination);
      o.start(t); o.stop(t+0.4);
      lullabyStep++;
    }, 500);
  }
}

render("start");
</script>
</body>
</html>
